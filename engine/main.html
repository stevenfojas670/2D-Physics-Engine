<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Physics Engine</title>
		<style>
			* {
				padding: 0;
				margin: 0;
			}
			canvas {
				background: #eee;
				display: block;
				margin: 20px auto;
			}
		</style>
	</head>
	<body>
		<canvas id="myCanvas" width="1280" height="720"></canvas>
		<script src="simulation.js"></script>
		<script src="Vector2.js"></script>
		<script src="utils/DrawUtils.js"></script>
		<script src="utils/MathHelper.js"></script>
		<script src="shapes/Shape.js"></script>
		<script src="shapes/Circle.js"></script>
		<script src="shapes/Polygon.js"></script>
		<script src="shapes/Rectangle.js"></script>

		<script>
			var canvas = document.getElementById("myCanvas")
			var ctx = canvas.getContext("2d")

			let lastTime = performance.now()
			let currentTime = 0
			let deltaTime = 0

			let mousePos = [0, 0]
			let mouseDownLeft = false
			let mouseDownRight = false

			let simulation = new Simulation()

			// Calculating the mouse position in the canvas
			function getMousePos(canvas, evt) {
				var rect = canvas.getBoundingClientRect()
				return { x: evt.clientX - rect.left, y: evt.clientY - rect.top }
			}

			// Event listener for keys being pressed
			window.addEventListener("keydown", (evt) => {
				simulation.onKeyboardPressed(evt)
			})

			// Event listener for mouse position within the canvas
			canvas.addEventListener("mousemove", (evt) => {
				mouse = getMousePos(canvas, evt)
				mousePos = [mouse.x, mouse.y]

				console.log(mousePos)
			})

			window.addEventListener("mousedown", (evt) => {
				if (evt.button === 0) mouseDownLeft = true
				if (evt.button === 2) mouseDownRight = true

				console.log(mouseDownLeft)
			})

			window.addEventListener("mouseup", (evt) => {
				if (evt.button === 0) mouseDownLeft = false
				if (evt.button === 2) mouseDownRight = false

				console.log(mouseDownLeft)
			})

			mainLoop()

			function updateSimulation(deltaTime) {
				simulation.update(deltaTime)
				Clear()
				simulation.draw(ctx)
			}

			function mainLoop() {
				window.requestAnimationFrame(mainLoop)

				currentTime = performance.now()
				deltaTime = (currentTime - lastTime) / 1000
				updateSimulation(deltaTime)

				lastTime = currentTime
			}

			function Clear() {
				ctx.fillStyle = "white"
				ctx.fillRect(0, 0, canvas.width, canvas.height)
			}
		</script>
	</body>
</html>
